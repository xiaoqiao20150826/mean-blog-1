var app=angular.module("multiBlog",["ngMessages","ngFileUpload","ui.bootstrap","ngRoute"]),config=function(e,t){e.when("/",{templateUrl:"/views/tpls/posts/index.html",controller:"IndexController"}).when("/users/login",{templateUrl:"views/tpls/users/login.html",controller:"LoginController"}).when("/users/logout",{template:"<div></div>",controller:"LogoutController"}).when("/users/reg",{templateUrl:"views/tpls/users/reg.html",controller:"RegController"}).when("/posts/publish",{templateUrl:"views/tpls/posts/publish.html",controller:"PublishController"}).when("/posts/user/:username",{templateUrl:"views/tpls/posts/userPosts.html",controller:"UserPostsController"}).when("/posts/post/:username/:day/:title",{templateUrl:"views/tpls/posts/post.html",controller:"PostController"}).when("/posts/edit/:username/:day/:title",{templateUrl:"views/tpls/posts/edit.html",controller:"EditController"}).when("/posts/remove/:username/:day/:title",{template:"<div></div>",controller:"RemoveController"}).otherwise({redirectTo:"/"}),t.html5Mode(!0)};config.$inject=["$routeProvider","$locationProvider"],app.config(config);
var app=angular.module("multiBlog"),IndexController=function(t,n,o){t.data={totalItems:0,itemsPerPage:2,currentPage:1,maxSize:5,pageChanged:function(){n({method:"GET",url:"/api?p="+t.data.currentPage}).success(function(n){t.posts=angular.forEach(angular.fromJson(n.posts),function(t){t.content=o.trustAsHtml(t.content)})}).error(function(t){console.log(t)})}},n({method:"GET",url:"/api?p="+t.currentPage}).success(function(n){t.posts=angular.forEach(angular.fromJson(n.posts),function(t){t.content=o.trustAsHtml(t.content)}),t.data.totalItems=n.total,t.$parent.title=n.title,t.$parent.users=n.users}).error(function(t){console.log(t)})};IndexController.$inject=["$scope","$http","$sce"],app.controller("IndexController",IndexController);
var app=angular.module("multiBlog"),compile=function(n){return function(t,c,e){t.$watch(function(n){return n.$eval(e.compile)},function(e){c.html(e),n(c.contents())(t)})}};app.directive("compile",compile);
var common=angular.module("multiBlog"),CommonController=function(o,n){n({method:"GET",url:"/api/users"}).success(function(n){o.title=n.title,o.users=n.users}).error(function(o){console.log(o)})};CommonController.$inject=["$scope","$http"],common.controller("CommonController",CommonController);
var common=angular.module("multiBlog"),ensureUnique=function(n){return{require:"ngModel",link:function(e,i,u,o){e.$watch(u.ngModel,function(e){e&&n({method:"POST",url:"/api/users/check",data:{field:u.ensureUnique,value:e}}).success(function(n){o.$setValidity("unique",n.isUnique)}).error(function(n){o.$setValidity("unique",!1)})})}}},ngFocus=function(){var n="ng-focused";return{restrict:"A",require:"ngModel",link:function(e,i,u,o){o.$focused=!1,i.bind("focus",function(u){o.$setValidity("wrong",!0),i.addClass(n),e.$apply(function(){o.$focused=!0})}),i.bind("blur",function(u){i.removeClass(n),e.$apply(function(){o.$focused=!1})})}}},confirmed=function(){return{restrict:"A",require:"ngModel",link:function(n,e,i,u){n.$watch(i.ngModel,function(e){e&&(e==n.reg.password?u.$setValidity("confirmed",!0):u.$setValidity("confirmed",!1))})}}};ensureUnique.$inject=["$http"],common.directive("ensureUnique",ensureUnique),common.directive("ngFocus",ngFocus),common.directive("confirmed",confirmed);
var posts=angular.module("multiBlog"),PublishController=function(t,o,e){t.$parent.title="发布",t.submitted=!1,t.submitForm=function(){t.publishForm.$valid?o({method:"POST",url:"/api/posts/publish",data:{title:t.publish.title,content:t.publish.content}}).success(function(o){o.result===!0?e.path("/"):t.publishForm.content.$setValidity("confirm",!1)}).error(function(t){console.log(t)}):t.submitted=!0}},EditController=function(t,o,e,n){t.$parent.title="编辑",t.edit={title:null,content:null},o({method:"GET",url:"/api/posts/edit/"+e.username+"/"+e.day+"/"+e.title}).success(function(o){t.edit.title=o.post.title,t.edit.content=o.post.content}).error(function(t){console.log(t)}),t.submitted=!1,t.submitForm=function(){t.editForm.$valid?o({method:"POST",url:"/api/posts/edit",data:{title:t.edit.title,content:t.edit.content}}).success(function(o){o.result===!0?n.path("/"):t.editForm.content.$setValidity("confirm",!1)}).error(function(t){console.log(t)}):t.submitted=!0}},RemoveController=function(t,o,e,n){o({method:"POST",url:"/api/posts/remove/",data:{username:e.username,day:e.day,title:e.title}}).success(function(t){console.log(t),t.result===!0&&n.path("/")}).error(function(t){console.log(t)})},UploadController=function(t,o){t.$watch("files",function(){t.upload(t.files)}),t.log="",t.uploadeds=[],t.upload=function(e){if(e&&e.length)for(var n=0;n<e.length;n++){var l=e[n];o.upload({url:"/api/posts/upload",file:l}).progress(function(o){var e=parseInt(100*o.loaded/o.total);t.log="progress: "+e+"% "+o.config.file.name+"\n"}).success(function(o,e,n,l){t.uploadeds.push(o)})}}},UserPostsController=function(t,o,e,n){t.data={totalItems:0,itemsPerPage:2,currentPage:1,maxSize:5,pageChanged:function(){o({method:"GET",url:"/api/posts/user/"+n.username+"?p="+t.data.currentPage}).success(function(o){t.posts=angular.forEach(angular.fromJson(o.posts),function(t){t.content=e.trustAsHtml(t.content)})}).error(function(t){console.log(t)})}},o({method:"GET",url:"/api/posts/user/"+n.username+"?p="+t.data.currentPage}).success(function(o){t.posts=angular.forEach(angular.fromJson(o.posts),function(t){t.content=e.trustAsHtml(t.content)}),t.data.totalItems=o.total,t.$parent.title=o.title,t.$parent.users=o.users}).error(function(t){console.log(t)})},PostController=function(t,o,e,n){o({method:"GET",url:"/api/posts/post/"+n.username+"/"+n.day+"/"+n.title}).success(function(o){t.posts=angular.forEach(angular.fromJson(o.posts),function(t){t.content=e.trustAsHtml(t.content)}),t.$parent.title=o.title}).error(function(t){console.log(t)})};PublishController.$inject=["$scope","$http","$location"],EditController.$inject=["$scope","$http","$routeParams","$location"],RemoveController.$inject=["$scope","$http","$routeParams","$location"],PostController.$inject=["$scope","$http","$sce","$routeParams"],UserPostsController.$inject=["$scope","$http","$sce","$routeParams"],UploadController.$inject=["$scope","Upload"],posts.controller("PublishController",PublishController),posts.controller("EditController",EditController),posts.controller("RemoveController",RemoveController),posts.controller("PostController",PostController),posts.controller("UploadController",UploadController),posts.controller("UserPostsController",UserPostsController);
var users=angular.module("multiBlog"),LoginController=function(o,e,r){o.$parent.title="登陆",o.submitted=!1,o.submitForm=function(){o.loginForm.$valid?e({method:"POST",url:"/api/users/login",data:{username:o.login.username,password:o.login.password}}).success(function(e){e.result===!0?r.path("/"):o.loginForm.password.$setValidity("wrong",!1)}).error(function(o){console.log(o)}):o.loginForm.submitted=!0}},LogoutController=function(o,e,r){e({method:"GET",url:"/api/users/logout"}).success(function(e){o.$parent.title=e.title,o.$parent.users=e.users,r.path("/")}).error(function(o){console.log(o)})},RegController=function(o,e,r){o.$parent.title="注册",o.submitted=!1,o.submitForm=function(){o.regForm.$valid?e({method:"POST",url:"/api/users/reg",data:{username:o.reg.username,password:o.reg.password,email:o.reg.email}}).success(function(e){e.result===!0?r.path("/"):"username"==e.reason?o.regForm.username.$setValidity("unique",!1):"email"==e.reason&&o.regForm.email.$setValidity("unique",!1)}).error(function(o){console.log(o)}):o.regForm.submitted=!0}};RegController.$inject=["$scope","$http","$location"],LoginController.$inject=["$scope","$http","$location"],LogoutController.$inject=["$scope","$http","$location"],users.controller("RegController",RegController),users.controller("LoginController",LoginController),users.controller("LogoutController",LogoutController);