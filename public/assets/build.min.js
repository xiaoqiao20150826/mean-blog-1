var app=angular.module("app",[]),MyController=function(o){o.clock={now:new Date};var n=function(){o.clock.now=new Date};setInterval(function(){o.$apply(n)},1e3),n()};MyController.$inject=["$scope"],app.controller("MyController",MyController);
var posts=angular.module("posts",["ngMessages","ngFileUpload"]),PublishController=function(o,l){o.submitted=!1,o.submitForm=function(){o.publishForm.$valid?l({method:"POST",url:"/posts/publish",data:{title:o.publish.title,content:o.publish.content}}).success(function(l){l.result===!0?window.location="/":o.publishForm.content.$setValidity("confirm",!1)}).error(function(o){console.log(o)}):o.publishForm.submitted=!0}},UploadController=function(o,l){o.$watch("file",function(l){o.upload(o.file)}),o.$watch("files",function(){o.upload(o.files)}),o.log="",o.upload=function(t){if(t&&t.length)for(var n=0;n<t.length;n++){var e=t[n];l.upload({url:"/posts/upload",fields:{username:o.username},file:e}).progress(function(l){var t=parseInt(100*l.loaded/l.total);o.log="progress: "+t+"% "+l.config.file.name+"\n"+o.log}).success(function(o,l,t,n){})}}};PublishController.$inject=["$scope","$http"],UploadController.$inject=["$scope","Upload"],posts.controller("PublishController",PublishController),posts.controller("UploadController",UploadController);
var posts=angular.module("posts"),ngFocus=function(){var n="ng-focused";return{restrict:"A",require:"ngModel",link:function(o,s,u,c){c.$focused=!1,s.bind("focus",function(u){c.$setValidity("confirm",!0),s.addClass(n),o.$apply(function(){c.$focused=!0})}),s.bind("blur",function(u){s.removeClass(n),o.$apply(function(){c.$focused=!1})})}}};posts.directive("ngFocus",ngFocus);
var users=angular.module("users",["ngMessages"]),LoginController=function(o,e){o.submitted=!1,o.submitForm=function(){o.loginForm.$valid?e({method:"POST",url:"/users/login",data:{username:o.login.username,password:o.login.password}}).success(function(e){e.result===!0?window.location="/":o.loginForm.password.$setValidity("wrong",!1)}).error(function(o){console.log(o)}):o.loginForm.submitted=!0}},RegController=function(o,e){o.submitted=!1,o.submitForm=function(){o.regForm.$valid?e({method:"POST",url:"/users/reg",data:{username:o.reg.username,password:o.reg.password,email:o.reg.email}}).success(function(e){e.result===!0?window.location="/":"username"==e.reason?o.regForm.username.$setValidity("unique",!1):"email"==e.reason&&o.regForm.email.$setValidity("unique",!1)}).error(function(o){console.log(o)}):o.regForm.submitted=!0}};RegController.$inject=["$scope","$http"],LoginController.$inject=["$scope","$http"],users.controller("RegController",RegController),users.controller("LoginController",LoginController);
var users=angular.module("users"),ensureUnique=function(e){return{require:"ngModel",link:function(n,i,u,r){n.$watch(u.ngModel,function(n){n&&e({method:"POST",url:"/users/check",data:{field:u.ensureUnique,value:n}}).success(function(e){r.$setValidity("unique",e.isUnique)}).error(function(e){r.$setValidity("unique",!1)})})}}},ngFocus=function(){var e="ng-focused";return{restrict:"A",require:"ngModel",link:function(n,i,u,r){r.$focused=!1,i.bind("focus",function(u){r.$setValidity("wrong",!0),i.addClass(e),n.$apply(function(){r.$focused=!0})}),i.bind("blur",function(u){i.removeClass(e),n.$apply(function(){r.$focused=!1})})}}},confirmed=function(){return{restrict:"A",require:"ngModel",link:function(e,n,i,u){e.$watch(i.ngModel,function(n){n&&(n==e.reg.password?u.$setValidity("confirmed",!0):u.$setValidity("confirmed",!1))})}}};ensureUnique.$inject=["$http"],users.directive("ensureUnique",ensureUnique),users.directive("ngFocus",ngFocus),users.directive("confirmed",confirmed);