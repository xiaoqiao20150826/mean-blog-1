var app=angular.module("app",["ngRoute"]);app.config(["$routeProvider","$locationProvider",function(e,o){e.when("/",{templateUrl:"/views/tpls/welcome.html",controller:"WelcomeController"}).otherwise({redirectTo:"/"}),o.html5Mode(!0)}]);
function WelcomeController(e){e.username="Conan_Z"}var app=angular.module("app");WelcomeController.$inject=["$scope"],app.controller("WelcomeController",WelcomeController);
var app=angular.module("index",[]),IndexController=function(n,o,r){o({method:"POST",url:"/"}).success(function(o){n.posts=angular.forEach(angular.fromJson(o.posts),function(n){n.content=r.trustAsHtml(n.content)}),n.users=o.users}).error(function(n){console.log(n)})};IndexController.$inject=["$scope","$http","$sce"],app.controller("IndexController",IndexController);
var app=angular.module("index"),compile=function(n){return function(e,c,i){e.$watch(function(n){return n.$eval(i.compile)},function(i){c.html(i),n(c.contents())(e)})}};app.directive("compile",compile);
var posts=angular.module("posts",["ngMessages","ngFileUpload","ui.bootstrap","app"]),PublishController=function(o,t){o.submitted=!1,o.submitForm=function(){o.publishForm.$valid?t({method:"POST",url:"/posts/publish",data:{title:o.publish.title,content:o.publish.content}}).success(function(t){t.result===!0?window.location="/":o.publishForm.content.$setValidity("confirm",!1)}).error(function(o){console.log(o)}):o.submitted=!0}},EditController=function(o,t){o.submitted=!1,o.submitForm=function(){o.editForm.$valid?t({method:"POST",url:"/posts/edit",data:{title:o.edit.title,content:o.edit.content}}).success(function(t){t.result===!0?window.location="/":o.editForm.content.$setValidity("confirm",!1)}).error(function(o){console.log(o)}):o.submitted=!0}},UploadController=function(o,t){o.$watch("files",function(){o.upload(o.files)}),o.log="",o.uploadeds=[],o.upload=function(n){if(n&&n.length)for(var s=0;s<n.length;s++){var e=n[s];t.upload({url:"/posts/upload",file:e}).progress(function(t){var n=parseInt(100*t.loaded/t.total);o.log="progress: "+n+"% "+t.config.file.name+"\n"}).success(function(t,n,s,e){o.uploadeds.push(t)})}}},UserPostController=function(o,t,n){o.currentPage=1,o.$watch("username",function(){console.log(o.username)}),t({method:"POST",url:"/posts/user/",data:{username:o.username,page:o.currentPage}}).success(function(t){o.posts=angular.forEach(angular.fromJson(t.posts),function(o){o.content=n.trustAsHtml(o.content)}),o.users=t.users,console.log(t)}).error(function(o){console.log(o)})},PostController=function(o,t,n){t({method:"GET",url:"/posts/user/:username"}).success(function(t){o.posts=angular.forEach(angular.fromJson(t.posts),function(o){o.content=n.trustAsHtml(o.content)}),o.users=t.users}).error(function(o){console.log(o)})};PublishController.$inject=["$scope","$http"],EditController.$inject=["$scope","$http"],PostController.$inject=["$scope","$http","$sce"],UserPostController.$inject=["$scope","$http","$sce"],UploadController.$inject=["$scope","Upload"],posts.controller("PublishController",PublishController),posts.controller("EditController",EditController),posts.controller("PostController",PostController),posts.controller("UploadController",UploadController),posts.controller("UserPostController",UserPostController);
var posts=angular.module("posts"),ngFocus=function(){var e="ng-focused";return{restrict:"A",require:"ngModel",link:function(n,o,u,s){s.$focused=!1,o.bind("focus",function(u){s.$setValidity("confirm",!0),o.addClass(e),n.$apply(function(){s.$focused=!0})}),o.bind("blur",function(u){o.removeClass(e),n.$apply(function(){s.$focused=!1})})}}},haveValue=function(){return{restrict:"A",require:"ngModel",scope:{ngModel:"="},link:function(e,n,o,u){e.ngModel=o.haveValue}}};posts.directive("ngFocus",ngFocus),posts.directive("haveValue",haveValue);
var users=angular.module("users",["ngMessages"]),LoginController=function(o,e){o.submitted=!1,o.submitForm=function(){o.loginForm.$valid?e({method:"POST",url:"/users/login",data:{username:o.login.username,password:o.login.password}}).success(function(e){e.result===!0?window.location="/":o.loginForm.password.$setValidity("wrong",!1)}).error(function(o){console.log(o)}):o.loginForm.submitted=!0}},RegController=function(o,e){o.submitted=!1,o.submitForm=function(){o.regForm.$valid?e({method:"POST",url:"/users/reg",data:{username:o.reg.username,password:o.reg.password,email:o.reg.email}}).success(function(e){e.result===!0?window.location="/":"username"==e.reason?o.regForm.username.$setValidity("unique",!1):"email"==e.reason&&o.regForm.email.$setValidity("unique",!1)}).error(function(o){console.log(o)}):o.regForm.submitted=!0}};RegController.$inject=["$scope","$http"],LoginController.$inject=["$scope","$http"],users.controller("RegController",RegController),users.controller("LoginController",LoginController);
var users=angular.module("users"),ensureUnique=function(e){return{require:"ngModel",link:function(n,i,u,r){n.$watch(u.ngModel,function(n){n&&e({method:"POST",url:"/users/check",data:{field:u.ensureUnique,value:n}}).success(function(e){r.$setValidity("unique",e.isUnique)}).error(function(e){r.$setValidity("unique",!1)})})}}},ngFocus=function(){var e="ng-focused";return{restrict:"A",require:"ngModel",link:function(n,i,u,r){r.$focused=!1,i.bind("focus",function(u){r.$setValidity("wrong",!0),i.addClass(e),n.$apply(function(){r.$focused=!0})}),i.bind("blur",function(u){i.removeClass(e),n.$apply(function(){r.$focused=!1})})}}},confirmed=function(){return{restrict:"A",require:"ngModel",link:function(e,n,i,u){e.$watch(i.ngModel,function(n){n&&(n==e.reg.password?u.$setValidity("confirmed",!0):u.$setValidity("confirmed",!1))})}}};ensureUnique.$inject=["$http"],users.directive("ensureUnique",ensureUnique),users.directive("ngFocus",ngFocus),users.directive("confirmed",confirmed);