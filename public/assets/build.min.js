var app=angular.module("multiBlog",["ngMessages","ngFileUpload","ui.bootstrap","ngRoute"]),config=function(e,l){e.when("/",{templateUrl:"/views/tpls/posts/index.html",controller:"IndexController"}).when("/users/login",{templateUrl:"views/tpls/users/login.html",controller:"LoginController"}).when("/users/logout",{template:"<div></div>",controller:"LogoutController"}).when("/users/reg",{templateUrl:"views/tpls/users/reg.html",controller:"RegController"}).when("/posts/publish",{templateUrl:"views/tpls/posts/publish.html",controller:"PublishController"}).when("/posts/edit/:username/:day/:title",{templateUrl:"views/tpls/posts/edit.html",controller:"EditController"}).otherwise({redirectTo:"/"}),l.html5Mode(!0)};config.$inject=["$routeProvider","$locationProvider"],app.config(config);
var common=angular.module("multiBlog"),CommonController=function(o,n){n({method:"GET",url:"/api/users"}).success(function(n){o.title=n.title,o.users=n.users}).error(function(o){console.log(o)})};CommonController.$inject=["$scope","$http"],common.controller("CommonController",CommonController);
var common=angular.module("multiBlog"),ensureUnique=function(n){return{require:"ngModel",link:function(e,i,u,o){e.$watch(u.ngModel,function(e){e&&n({method:"POST",url:"/api/users/check",data:{field:u.ensureUnique,value:e}}).success(function(n){o.$setValidity("unique",n.isUnique)}).error(function(n){o.$setValidity("unique",!1)})})}}},ngFocus=function(){var n="ng-focused";return{restrict:"A",require:"ngModel",link:function(e,i,u,o){o.$focused=!1,i.bind("focus",function(u){o.$setValidity("wrong",!0),i.addClass(n),e.$apply(function(){o.$focused=!0})}),i.bind("blur",function(u){i.removeClass(n),e.$apply(function(){o.$focused=!1})})}}},confirmed=function(){return{restrict:"A",require:"ngModel",link:function(n,e,i,u){n.$watch(i.ngModel,function(e){e&&(e==n.reg.password?u.$setValidity("confirmed",!0):u.$setValidity("confirmed",!1))})}}};ensureUnique.$inject=["$http"],common.directive("ensureUnique",ensureUnique),common.directive("ngFocus",ngFocus),common.directive("confirmed",confirmed);
var app=angular.module("multiBlog"),IndexController=function(n,o,t){o({method:"GET",url:"/api"}).success(function(o){n.posts=angular.forEach(angular.fromJson(o.posts),function(n){n.content=t.trustAsHtml(n.content)}),n.$parent.title=o.title,n.$parent.users=o.users}).error(function(n){console.log(n)})};IndexController.$inject=["$scope","$http","$sce"],app.controller("IndexController",IndexController);
var app=angular.module("multiBlog"),compile=function(n){return function(t,c,e){t.$watch(function(n){return n.$eval(e.compile)},function(e){c.html(e),n(c.contents())(t)})}};app.directive("compile",compile);
var posts=angular.module("multiBlog"),PublishController=function(t,o){t.$parent.title="发布",t.submitted=!1,t.submitForm=function(){t.publishForm.$valid?o({method:"POST",url:"/api/posts/publish",data:{title:t.publish.title,content:t.publish.content}}).success(function(o){o.result===!0?window.location="/":t.publishForm.content.$setValidity("confirm",!1)}).error(function(t){console.log(t)}):t.submitted=!0}},EditController=function(t,o,e){t.$parent.title="编辑",t.edit={title:null,content:null},o({method:"GET",url:"/api/posts/edit/"+e.username+"/"+e.day+"/"+e.title}).success(function(o){t.edit.title=o.post.title,t.edit.content=o.post.content}).error(function(t){console.log(t)}),t.submitted=!1,t.submitForm=function(){t.editForm.$valid?o({method:"POST",url:"/api/posts/edit",data:{title:t.edit.title,content:t.edit.content}}).success(function(o){o.result===!0?window.location="/":t.editForm.content.$setValidity("confirm",!1)}).error(function(t){console.log(t)}):t.submitted=!0}},UploadController=function(t,o){t.$watch("files",function(){t.upload(t.files)}),t.log="",t.uploadeds=[],t.upload=function(e){if(e&&e.length)for(var n=0;n<e.length;n++){var l=e[n];o.upload({url:"/api/posts/upload",file:l}).progress(function(o){var e=parseInt(100*o.loaded/o.total);t.log="progress: "+e+"% "+o.config.file.name+"\n"}).success(function(o,e,n,l){t.uploadeds.push(o)})}}},UserPostController=function(t,o,e){t.currentPage=1,t.$watch("username",function(){console.log(t.username)}),o({method:"POST",url:"/api/posts/user/",data:{username:t.username,page:t.currentPage}}).success(function(o){t.posts=angular.forEach(angular.fromJson(o.posts),function(t){t.content=e.trustAsHtml(t.content)}),t.users=o.users,console.log(o)}).error(function(t){console.log(t)})},PostController=function(t,o,e){o({method:"GET",url:"/api/posts/user/:username"}).success(function(o){t.posts=angular.forEach(angular.fromJson(o.posts),function(t){t.content=e.trustAsHtml(t.content)}),t.users=o.users}).error(function(t){console.log(t)})};PublishController.$inject=["$scope","$http"],EditController.$inject=["$scope","$http","$routeParams"],PostController.$inject=["$scope","$http","$sce"],UserPostController.$inject=["$scope","$http","$sce"],UploadController.$inject=["$scope","Upload"],posts.controller("PublishController",PublishController),posts.controller("EditController",EditController),posts.controller("PostController",PostController),posts.controller("UploadController",UploadController),posts.controller("UserPostController",UserPostController);
var users=angular.module("multiBlog"),LoginController=function(o,e,r){o.$parent.title="登陆",o.submitted=!1,o.submitForm=function(){o.loginForm.$valid?e({method:"POST",url:"/api/users/login",data:{username:o.login.username,password:o.login.password}}).success(function(e){e.result===!0?r.path("/"):o.loginForm.password.$setValidity("wrong",!1)}).error(function(o){console.log(o)}):o.loginForm.submitted=!0}},LogoutController=function(o,e,r){e({method:"GET",url:"/api/users/logout"}).success(function(e){o.$parent.title=e.title,o.$parent.users=e.users,r.path("/")}).error(function(o){console.log(o)})},RegController=function(o,e,r){o.$parent.title="注册",o.submitted=!1,o.submitForm=function(){o.regForm.$valid?e({method:"POST",url:"/api/users/reg",data:{username:o.reg.username,password:o.reg.password,email:o.reg.email}}).success(function(e){e.result===!0?r.path("/"):"username"==e.reason?o.regForm.username.$setValidity("unique",!1):"email"==e.reason&&o.regForm.email.$setValidity("unique",!1)}).error(function(o){console.log(o)}):o.regForm.submitted=!0}};RegController.$inject=["$scope","$http","$location"],LoginController.$inject=["$scope","$http","$location"],LogoutController.$inject=["$scope","$http","$location"],users.controller("RegController",RegController),users.controller("LoginController",LoginController),users.controller("LogoutController",LogoutController);